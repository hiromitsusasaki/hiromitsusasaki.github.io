{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/creating-blogging-environment-with-gatsbyjs-github-pages-and-actions/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Promitsujp"}},"markdownRemark":{"id":"3a946475-6e36-538f-abb8-17cbfb45b382","excerpt":"React.js を触る機会が増えそうな気配が濃厚だったので、ふと思い立ち Gatsby.js でブログを作って、Github Pages で公開しようと思い、どうせなら GitHub Actions で CI（というか公開の自動化）をしてみようと思って、このブログを作ってみた。 Gatsby.js…","html":"<p>React.js を触る機会が増えそうな気配が濃厚だったので、ふと思い立ち Gatsby.js でブログを作って、Github Pages で公開しようと思い、どうせなら GitHub Actions で CI（というか公開の自動化）をしてみようと思って、このブログを作ってみた。</p>\n<h2>Gatsby.js のセットアップ</h2>\n<p>ブログサイトの作成は React.js 製の静的サイトジェネレータの<a href=\"https://www.gatsbyjs.com/\">Gatby.js</a>を使う。</p>\n<p>まずは、ローカルに Gatsby CLI をインストール</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">yarn</span> global <span class=\"token function\">add</span> gatsby-cli</code></pre></div>\n<p>Gatsby.js には starter と呼ばれるテンプレート機構があり、有志がさまざまなサイト向けのテンプレートを公開している。今回の目的はブログサイトなので、以下のブログ向けスターターテンプレートを利用することにした。(あとから色々手を加えたいのでできるだけシンプルなものにした)</p>\n<p><a href=\"https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog/\">gatsby-starter-blog</a></p>\n<p>上記のスターターテンプレートを利用して、プロジェクトファイル一式を生成</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ gatsby new hiromitsusasaki.github.io https://github.com/gatsbyjs/gatsby-starter-blog\n</code></pre></div>\n<p>以下のような構成のファイル・ディレクトリが生成される</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token builtin class-name\">cd</span> hiromitsusasaki.github.io\n$ tree -L <span class=\"token number\">1</span>\n<span class=\"token builtin class-name\">.</span>\n├── LICENSE\n├── README.md\n├── content\n│     └── blog\n├── gatsby-browser.js\n├── gatsby-config.js\n├── gatsby-node.js\n├── node_modules\n├── package-lock.json\n├── package.json\n├── public\n├── src\n│    ├── components\n│    ├── images\n│    ├── pages\n│    ├── normalize.css\n│    └── style.css\n└── static\n</code></pre></div>\n<p><code class=\"language-text\">static</code>以下に Reactjs のコンポーネントやそれが参照する CSS、画像などのリソースが入っている。また、<code class=\"language-text\">content/blog/</code>以下には記事ごとのディレクトリ、そのディレクトリ内には記事本体の Markdown ファイルとそれが参照する画像などのリソースファイルが配置されている（３記事分のサンプル）</p>\n<p>公開されるブログ記事は、<code class=\"language-text\">content/blog/</code>以下の各ディレクトリの Markdown ファイルの内容を、<code class=\"language-text\">src/templates/blog-post.js</code>のテンプレートに適用する形で生成される。</p>\n<p><code class=\"language-text\">new</code> した時点で必要な node module はインストール済みになっているので、以下のコマンドで開発用サーバが起動できる。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">yarn</span> development\n<span class=\"token function\">yarn</span> run v1.22.10\n<span class=\"token punctuation\">..</span>.\n\nYou can now view gatsby-starter-blog <span class=\"token keyword\">in</span> the browser.\n\n  http://localhost:8000/\n\nView GraphiQL, an in-browser IDE, to explore your site's data and schema\n\n  http://localhost:8000/___graphql\n\n<span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>また、</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">yarn</span> build</code></pre></div>\n<p>で、プロダクションビルドの結果が<code class=\"language-text\">public</code>ディレクトリ以下に生成される</p>\n<h2>GitHub Pages で公開</h2>\n<p>GitHub Pages は、GitHub にある特定のリポジトリの特定のブランチの内容を静的サイトとして配信することができるサービス。</p>\n<p><code class=\"language-text\">{user_name}.github.io</code>というリポジトリを作成して、そのリポジトリの Settings から GitHub Pages の公開設定を行うことができる（無料アカウントの場合は Public リポジトリでしか利用できないっぽい）</p>\n<p>詳しくは下記ドキュメントを参照。</p>\n<p><a href=\"https://docs.github.com/ja/pages\">https://docs.github.com/ja/pages</a></p>\n<h2>GitHub Actions で自動公開設定</h2>\n<p>せっかくプロジェクトもサイトホスティングも GitHub を利用しているので、公開も GitHub Actions を使い、<code class=\"language-text\">main</code>ブランチへの Push をフックに自動で公開されるように設定した。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">mkdir</span> -p .github/workflows\n$ <span class=\"token function\">touch</span> .github/workflows/gh-pages.yml</code></pre></div>\n<p>Github Actions のワークフロー設定は、ググって見つけた下記の Qiita 記事を参考に、このようなファイルを作成。</p>\n<p><a href=\"https://qiita.com/peaceiris/items/2f6d83802f2aefa66f9d\">https://qiita.com/peaceiris/items/2f6d83802f2aefa66f9d</a></p>\n<p><code class=\"language-text\">/github/workflows/gh-pages.yml</code></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GitHub Pages\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> main\n  <span class=\"token key atrule\">pull_request</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span><span class=\"token number\">20.04</span>\n    <span class=\"token key atrule\">concurrency</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.workflow <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.ref <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Setup Node\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"14\"</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Cache dependencies\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/cache@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> ~/.npm\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> runner.os <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>node<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> hashFiles('<span class=\"token important\">**/package-lock.json')</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">restore-keys</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            ${{ runner.os }}-node-</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm ci\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run format\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peaceiris/actions<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages@v3\n        <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.ref == 'refs/heads/main' <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">publish_dir</span><span class=\"token punctuation\">:</span> ./public</code></pre></div>\n<p>参照元のワークフローでは<code class=\"language-text\">npm run test</code>の実行も含まれていたが、今回はスターターキットそのままでのデプロイなので、一旦削除した（テスト実行をできるようにするには色々とパッケージや設定を追加する必要があるので、必要になった段階で、別途記事を書きたい）</p>\n<p>この状態で、リポジトリ（{user_name.github.io}）のデフォルトブランチに push すると、GitHub Actions のワークフローが起動し、ブログ・サイトが公開される。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9aefbe48b8bdbd178f45e744f9871210/a2b91/screenshot_000.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVQoz32RwW6DMAyG+/4vtJ67R+C2w1Q6BASRBhI7sRMnTC1TtdKNT1bkyxf9tg/LL2JMH5/ny1fTNI1Squ/7ruvatu26TimltV6eOTzL8f10ejseq6rSWg/DcH/V2iDCnpxzBkD0njkyc86ZiGNKSSSlRMx7sogAABEBIAASM92J8fYX0a6cUjrXl7puhmE0ZmLmJKWUsvzDNrb3wQFYa4lIRIhjlryUH/bkUop3FufZzRN5jBTW4uDX2vjbmcdRj6OeptmY6Xo1zoFzYK1DQETcj12MC54439YrIvJI9OfkL6dCTxxDoEDEHL0Prxd6yN/QzEfgj8EfDAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"スクリーンショット\"\n        title=\"スクリーンショット\"\n        src=\"/static/9aefbe48b8bdbd178f45e744f9871210/f058b/screenshot_000.png\"\n        srcset=\"/static/9aefbe48b8bdbd178f45e744f9871210/c26ae/screenshot_000.png 158w,\n/static/9aefbe48b8bdbd178f45e744f9871210/6bdcf/screenshot_000.png 315w,\n/static/9aefbe48b8bdbd178f45e744f9871210/f058b/screenshot_000.png 630w,\n/static/9aefbe48b8bdbd178f45e744f9871210/40601/screenshot_000.png 945w,\n/static/9aefbe48b8bdbd178f45e744f9871210/78612/screenshot_000.png 1260w,\n/static/9aefbe48b8bdbd178f45e744f9871210/a2b91/screenshot_000.png 3360w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<hr>\n<h2>参照</h2>\n<p><a href=\"https://mojaie.github.io/gatsby-blog-memo/\">https://mojaie.github.io/gatsby-blog-memo/</a>\n<a href=\"https://www.gatsbyjs.com/docs/how-to/local-development/starters/\">https://www.gatsbyjs.com/docs/how-to/local-development/starters/</a>\n<a href=\"https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog/\">https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog/</a>\n<a href=\"https://qiita.com/peaceiris/items/2f6d83802f2aefa66f9d\">https://qiita.com/peaceiris/items/2f6d83802f2aefa66f9d</a>\n<a href=\"https://github.com/peaceiris/actions-gh-pages\">https://github.com/peaceiris/actions-gh-pages</a>\n<a href=\"https://www.gatsbyjs.com/docs/how-to/testing/unit-testing/\">https://www.gatsbyjs.com/docs/how-to/testing/unit-testing/</a></p>","frontmatter":{"title":"GatsbyとGithub ActionsでGithub Pagesにブログを公開する","date":"September 04, 2021","description":null}},"previous":null,"next":null},"pageContext":{"id":"3a946475-6e36-538f-abb8-17cbfb45b382","previousPostId":null,"nextPostId":null}},
    "staticQueryHashes": ["2841359383","3257411868"]}